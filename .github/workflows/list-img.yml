name: List Images in JSON
on:
    push:
        paths:
            - "img/**"
            - ".github/workflows/list-img.yml"
    workflow_dispatch:
jobs:
    convert:
        runs-on: ubuntu-latest
        steps:
            - name: æª¢å‡ºåŸå§‹ç¢¼
              uses: actions/checkout@v2

            - name: è¨­å®š Node.js
              uses: actions/setup-node@v2
              with:
                  node-version: "20.10.0"

            - name: å®‰è£å¥—ä»¶
              run: |
                  sudo apt-get install -y webp libheif-examples imagemagick
                  sudo apt-get install -y ffmpeg
            - name: åˆ—å‡º HEIC æ–‡ä»¶
              run: find img -type f -name '*.HEIC'
            - name: HEIC to JPG
              run: |
                    find img -type f -name '*.HEIC' -exec sh -c '
                        output_file="${1%.*}.jpg"
                        heif-convert "$1" "$output_file"
                        # ç¢ºä¿è½‰æ›æˆåŠŸå¾Œåˆªé™¤åŸå§‹ HEIC æ–‡ä»¶
                        if [ -f "$output_file" ]; then
                            rm "$1"
                        fi
                    ' _ {} \;
            - name: åˆªé™¤å¤šé¤˜éæ¸¡æª”æ¡ˆ #heif-convert æœ‰æ™‚å€™æœƒç”¢ç”Ÿä¸€äº›é»‘ç™½çš„è¼”åŠ©åœ–ç‰‡ï¼Œé€™è£¡ä¸å¸Œæœ›è¢«åŠ é€²åœ–åº«
              run: find . -type f \( \( -name "*aux*" -a -name "*apple*" \) -o -name "*depth*" \) -delete
            - name: JPG è½‰æª”æˆ WebP
              run: |
                  find img -type d -exec mkdir -p converted/{} \;
                  find img -type f \( -name '*.png' -o -name '*.jpg' -o -name '*.JPG' -o -name '*.jpeg' -o -name '*.JPEG' \) -exec sh -c '
                  converted_file="converted/${1%.*}.webp"
                  echo "@!#$converted_file"
                  ffmpeg -i "$1" -q 50 "$converted_file"
                  ' _ {} \;
                  find converted -type f -name '*.webp' -exec sh -c 'convert "$1" -resize x1000 "$1"' _ {} \;
            - name: åˆ—å‡ºåœ–ç‰‡
              run: node ./list-img.js

            - name: æäº¤è®Šæ›´
              run: |
                  git config --local user.email "action@github.com"
                  git config --local user.name "GitHub Action"
                  git add .
                  if git diff --staged --quiet; then
                    echo "No changes"
                  else
                    git pull
                    git commit -m "ğŸ–¼ï¸æ›´æ–°åœ–ç‰‡åˆ—è¡¨"
                    git push
                  fi

                  